<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çŸ¥è¯†åº“ç®¡ç† - æ™ºèƒ½é—®ç­”Agent</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/p5.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        * {
            font-family: 'Noto Sans SC', sans-serif;
        }
        .bg-gradient-tech {
            background: linear-gradient(135deg, #0B1426 0%, #1a2332 50%, #0B1426 100%);
        }
        .text-glow {
            text-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
        }
        .card-glow {
            box-shadow: 0 4px 20px rgba(0, 212, 255, 0.1);
        }
        .particle-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }
        .sidebar-nav {
            backdrop-filter: blur(10px);
            background: rgba(11, 20, 38, 0.8);
        }
        .knowledge-card {
            backdrop-filter: blur(10px);
            background: rgba(26, 35, 50, 0.6);
            transition: all 0.3s ease;
        }
        .knowledge-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 212, 255, 0.15);
        }
        .category-item {
            transition: all 0.2s ease;
        }
        .category-item:hover {
            background: rgba(0, 212, 255, 0.1);
            transform: translateX(5px);
        }
        .category-item.active {
            background: rgba(0, 212, 255, 0.2);
            border-left: 3px solid #00D4FF;
        }
        .search-highlight {
            background: rgba(255, 184, 0, 0.3);
            padding: 2px 4px;
            border-radius: 3px;
        }
        .fade-in {
            animation: fadeIn 0.3s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gradient-tech text-white min-h-screen overflow-hidden">
    <!-- ç²’å­èƒŒæ™¯ -->
    <div id="particle-bg" class="particle-bg"></div>
    
    <!-- é¡¶éƒ¨å¯¼èˆª -->
    <nav class="fixed top-0 left-0 right-0 z-50 bg-black bg-opacity-20 backdrop-blur-md border-b border-gray-700">
        <div class="flex items-center justify-between px-6 py-4">
            <div class="flex items-center space-x-4">
                <div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-cyan-400 rounded-lg flex items-center justify-center">
                    <span class="text-white font-bold text-sm">AI</span>
                </div>
                <h1 class="text-xl font-bold text-glow">çŸ¥è¯†åº“ç®¡ç†</h1>
            </div>
            <div class="flex items-center space-x-6">
                <a href="index.html" class="nav-link text-gray-300 hover:text-white transition-colors">é—®ç­”</a>
                <a href="knowledge.html" class="nav-link text-cyan-400 border-b-2 border-cyan-400 pb-1">çŸ¥è¯†åº“</a>
                <a href="analytics.html" class="nav-link text-gray-300 hover:text-white transition-colors">åˆ†æ</a>
                <div class="flex items-center space-x-2">
                    <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                    <span class="text-sm text-gray-300">åœ¨çº¿</span>
                </div>
            </div>
        </div>
    </nav>

    <!-- ä¸»å®¹å™¨ -->
    <div class="flex h-screen pt-16">
        <!-- å·¦ä¾§åˆ†ç±»é¢æ¿ -->
        <div class="w-64 sidebar-nav border-r border-gray-700 p-4 overflow-y-auto">
            <div class="mb-6">
                <div class="flex items-center justify-between mb-3">
                    <h3 class="text-sm font-semibold text-gray-400">çŸ¥è¯†åˆ†ç±»</h3>
                    <button onclick="addCategory()" class="text-cyan-400 hover:text-cyan-300 text-sm">+ æ·»åŠ </button>
                </div>
                <div class="space-y-1" id="category-list">
                    <div class="category-item active px-3 py-2 rounded cursor-pointer" data-category="all" onclick="selectCategory('all')">
                        <div class="flex items-center justify-between">
                            <span>ğŸ“š å…¨éƒ¨çŸ¥è¯†</span>
                            <span class="text-xs bg-gray-600 px-2 py-1 rounded" id="total-count">24</span>
                        </div>
                    </div>
                    <div class="category-item px-3 py-2 rounded cursor-pointer" data-category="äººå·¥æ™ºèƒ½" onclick="selectCategory('äººå·¥æ™ºèƒ½')">
                        <div class="flex items-center justify-between">
                            <span>ğŸ¤– äººå·¥æ™ºèƒ½</span>
                            <span class="text-xs bg-gray-600 px-2 py-1 rounded">8</span>
                        </div>
                    </div>
                    <div class="category-item px-3 py-2 rounded cursor-pointer" data-category="æœºå™¨å­¦ä¹ " onclick="selectCategory('æœºå™¨å­¦ä¹ ')">
                        <div class="flex items-center justify-between">
                            <span>ğŸ§  æœºå™¨å­¦ä¹ </span>
                            <span class="text-xs bg-gray-600 px-2 py-1 rounded">6</span>
                        </div>
                    </div>
                    <div class="category-item px-3 py-2 rounded cursor-pointer" data-category="æ·±åº¦å­¦ä¹ " onclick="selectCategory('æ·±åº¦å­¦ä¹ ')">
                        <div class="flex items-center justify-between">
                            <span>ğŸ”¥ æ·±åº¦å­¦ä¹ </span>
                            <span class="text-xs bg-gray-600 px-2 py-1 rounded">5</span>
                        </div>
                    </div>
                    <div class="category-item px-3 py-2 rounded cursor-pointer" data-category="è‡ªç„¶è¯­è¨€å¤„ç†" onclick="selectCategory('è‡ªç„¶è¯­è¨€å¤„ç†')">
                        <div class="flex items-center justify-between">
                            <span>ğŸ’¬ è‡ªç„¶è¯­è¨€å¤„ç†</span>
                            <span class="text-xs bg-gray-600 px-2 py-1 rounded">3</span>
                        </div>
                    </div>
                    <div class="category-item px-3 py-2 rounded cursor-pointer" data-category="è®¡ç®—æœºè§†è§‰" onclick="selectCategory('è®¡ç®—æœºè§†è§‰')">
                        <div class="flex items-center justify-between">
                            <span>ğŸ‘ï¸ è®¡ç®—æœºè§†è§‰</span>
                            <span class="text-xs bg-gray-600 px-2 py-1 rounded">2</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ç»Ÿè®¡ä¿¡æ¯ -->
            <div class="bg-gray-800 bg-opacity-50 rounded-lg p-4">
                <h3 class="text-sm font-semibold text-gray-400 mb-3">çŸ¥è¯†åº“ç»Ÿè®¡</h3>
                <div class="space-y-2 text-xs">
                    <div class="flex justify-between">
                        <span class="text-gray-500">æ€»æ¡ç›®:</span>
                        <span class="text-cyan-400" id="stats-total">24</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-500">æœ¬æœˆæ–°å¢:</span>
                        <span class="text-cyan-400">7</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-500">ä½¿ç”¨é¢‘ç‡:</span>
                        <span class="text-cyan-400">89%</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- ä¸­å¤®å†…å®¹åŒºåŸŸ -->
        <div class="flex-1 flex flex-col overflow-hidden">
            <!-- æœç´¢å’Œå·¥å…·æ  -->
            <div class="bg-gray-800 bg-opacity-40 border-b border-gray-700 p-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-4 flex-1">
                        <div class="relative flex-1 max-w-md">
                            <input 
                                type="text" 
                                id="search-input"
                                placeholder="æœç´¢çŸ¥è¯†æ¡ç›®..." 
                                class="w-full bg-gray-700 bg-opacity-60 border border-gray-600 rounded-lg px-4 py-2 pl-10 text-white placeholder-gray-400 focus:outline-none focus:border-cyan-400 focus:ring-1 focus:ring-cyan-400"
                                oninput="searchKnowledge()"
                            >
                            <div class="absolute left-3 top-2.5 text-gray-400">ğŸ”</div>
                        </div>
                        <select id="sort-select" class="bg-gray-700 border border-gray-600 rounded px-3 py-2 text-white" onchange="sortKnowledge()">
                            <option value="recent">æœ€è¿‘æ›´æ–°</option>
                            <option value="usage">ä½¿ç”¨é¢‘ç‡</option>
                            <option value="name">åç§°æ’åº</option>
                        </select>
                    </div>
                    <button onclick="addKnowledge()" class="bg-gradient-to-r from-blue-500 to-cyan-400 hover:from-blue-600 hover:to-cyan-500 text-white px-4 py-2 rounded-lg font-medium transition-all duration-200 transform hover:scale-105">
                        + æ·»åŠ çŸ¥è¯†
                    </button>
                </div>
            </div>

            <!-- çŸ¥è¯†æ¡ç›®åˆ—è¡¨ -->
            <div class="flex-1 overflow-y-auto p-6" id="knowledge-list">
                <!-- çŸ¥è¯†æ¡ç›®å¡ç‰‡å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>

        <!-- å³ä¾§æ“ä½œé¢æ¿ -->
        <div class="w-80 sidebar-nav border-l border-gray-700 p-4 overflow-y-auto">
            <div id="edit-panel" class="hidden">
                <h3 class="text-lg font-semibold mb-4">ç¼–è¾‘çŸ¥è¯†</h3>
                <form id="knowledge-form" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">é—®é¢˜</label>
                        <input type="text" id="question-input" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-white" placeholder="è¾“å…¥é—®é¢˜...">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">åˆ†ç±»</label>
                        <select id="category-input" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-white">
                            <option value="äººå·¥æ™ºèƒ½">äººå·¥æ™ºèƒ½</option>
                            <option value="æœºå™¨å­¦ä¹ ">æœºå™¨å­¦ä¹ </option>
                            <option value="æ·±åº¦å­¦ä¹ ">æ·±åº¦å­¦ä¹ </option>
                            <option value="è‡ªç„¶è¯­è¨€å¤„ç†">è‡ªç„¶è¯­è¨€å¤„ç†</option>
                            <option value="è®¡ç®—æœºè§†è§‰">è®¡ç®—æœºè§†è§‰</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">æ ‡ç­¾</label>
                        <input type="text" id="tags-input" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-white" placeholder="æ ‡ç­¾1, æ ‡ç­¾2, æ ‡ç­¾3">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">ç­”æ¡ˆ</label>
                        <textarea id="answer-input" rows="8" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-white resize-none" placeholder="è¾“å…¥è¯¦ç»†ç­”æ¡ˆ..."></textarea>
                    </div>
                    <div class="flex space-x-3">
                        <button type="button" onclick="saveKnowledge()" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white py-2 rounded transition-colors">
                            ä¿å­˜
                        </button>
                        <button type="button" onclick="cancelEdit()" class="flex-1 bg-gray-600 hover:bg-gray-500 text-white py-2 rounded transition-colors">
                            å–æ¶ˆ
                        </button>
                    </div>
                </form>
            </div>

            <!-- çŸ¥è¯†åˆ†å¸ƒå›¾è¡¨ -->
            <div class="bg-gray-800 bg-opacity-50 rounded-lg p-4 mb-4">
                <h3 class="text-sm font-semibold text-gray-400 mb-3">çŸ¥è¯†åˆ†å¸ƒ</h3>
                <div id="knowledge-chart" style="height: 200px;"></div>
            </div>

            <!-- æœ€è¿‘æ´»åŠ¨ -->
            <div class="bg-gray-800 bg-opacity-50 rounded-lg p-4">
                <h3 class="text-sm font-semibold text-gray-400 mb-3">æœ€è¿‘æ´»åŠ¨</h3>
                <div class="space-y-2 text-xs">
                    <div class="flex items-center space-x-2">
                        <div class="w-2 h-2 bg-green-400 rounded-full"></div>
                        <span class="text-gray-300">æ·»åŠ äº†"ç¥ç»ç½‘ç»œåŸç†"</span>
                    </div>
                    <div class="flex items-center space-x-2">
                        <div class="w-2 h-2 bg-blue-400 rounded-full"></div>
                        <span class="text-gray-300">æ›´æ–°äº†"æ·±åº¦å­¦ä¹ åº”ç”¨"</span>
                    </div>
                    <div class="flex items-center space-x-2">
                        <div class="w-2 h-2 bg-yellow-400 rounded-full"></div>
                        <span class="text-gray-300">åˆ é™¤äº†"è¿‡æ—¶ç®—æ³•"</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- æ·»åŠ åˆ†ç±»å¼¹çª— -->
    <div id="category-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-gray-800 rounded-lg p-6 w-96 max-w-90vw">
            <h3 class="text-lg font-semibold mb-4">æ·»åŠ åˆ†ç±»</h3>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-2">åˆ†ç±»åç§°</label>
                    <input type="text" id="category-name-input" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-white" placeholder="è¾“å…¥åˆ†ç±»åç§°...">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">åˆ†ç±»å›¾æ ‡</label>
                    <input type="text" id="category-icon-input" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-white" placeholder="è¾“å…¥emojiå›¾æ ‡...">
                </div>
            </div>
            <div class="flex justify-end space-x-3 mt-6">
                <button onclick="closeCategoryModal()" class="bg-gray-600 hover:bg-gray-500 px-4 py-2 rounded transition-colors">å–æ¶ˆ</button>
                <button onclick="saveCategory()" class="bg-blue-500 hover:bg-blue-600 px-4 py-2 rounded transition-colors">ä¿å­˜</button>
            </div>
        </div>
    </div>

    <script>
        // çŸ¥è¯†åº“ç®¡ç†ç±»
        class KnowledgeManager {
            constructor() {
                this.knowledgeBase = this.loadKnowledgeBase();
                this.currentCategory = 'all';
                this.currentEditId = null;
                this.init();
            }

            init() {
                this.initParticleBackground();
                this.renderKnowledgeList();
                this.initChart();
                this.updateStats();
            }

            // åˆå§‹åŒ–ç²’å­èƒŒæ™¯
            initParticleBackground() {
                const sketch = (p) => {
                    let particles = [];
                    const numParticles = 30;

                    p.setup = () => {
                        const canvas = p.createCanvas(p.windowWidth, p.windowHeight);
                        canvas.parent('particle-bg');
                        
                        for (let i = 0; i < numParticles; i++) {
                            particles.push({
                                x: p.random(p.width),
                                y: p.random(p.height),
                                vx: p.random(-0.3, 0.3),
                                vy: p.random(-0.3, 0.3),
                                size: p.random(1, 2),
                                opacity: p.random(0.2, 0.6)
                            });
                        }
                    };

                    p.draw = () => {
                        p.clear();
                        
                        particles.forEach(particle => {
                            p.fill(0, 212, 255, particle.opacity * 255);
                            p.noStroke();
                            p.circle(particle.x, particle.y, particle.size);
                            
                            particle.x += particle.vx;
                            particle.y += particle.vy;
                            
                            if (particle.x < 0 || particle.x > p.width) particle.vx *= -1;
                            if (particle.y < 0 || particle.y > p.height) particle.vy *= -1;
                        });
                    };

                    p.windowResized = () => {
                        p.resizeCanvas(p.windowWidth, p.windowHeight);
                    };
                };

                new p5(sketch);
            }

            // åŠ è½½çŸ¥è¯†åº“
            loadKnowledgeBase() {
                const defaultKnowledge = [
                    {
                        id: 1,
                        question: 'ä»€ä¹ˆæ˜¯äººå·¥æ™ºèƒ½ï¼Ÿ',
                        category: 'äººå·¥æ™ºèƒ½',
                        tags: ['AI', 'å®šä¹‰', 'åŸºç¡€'],
                        answer: 'äººå·¥æ™ºèƒ½(AI)æ˜¯è®¡ç®—æœºç§‘å­¦çš„ä¸€ä¸ªåˆ†æ”¯ï¼Œè‡´åŠ›äºåˆ›å»ºèƒ½å¤Ÿæ‰§è¡Œé€šå¸¸éœ€è¦äººç±»æ™ºèƒ½çš„ä»»åŠ¡çš„ç³»ç»Ÿï¼ŒåŒ…æ‹¬å­¦ä¹ ã€æ¨ç†ã€æ„ŸçŸ¥å’Œè¯­è¨€ç†è§£ã€‚',
                        usage: 45,
                        lastUsed: new Date('2025-12-23'),
                        created: new Date('2025-12-20')
                    },
                    {
                        id: 2,
                        question: 'æœºå™¨å­¦ä¹ ä¸æ·±åº¦å­¦ä¹ çš„åŒºåˆ«ï¼Ÿ',
                        category: 'æœºå™¨å­¦ä¹ ',
                        tags: ['æœºå™¨å­¦ä¹ ', 'æ·±åº¦å­¦ä¹ ', 'å¯¹æ¯”'],
                        answer: 'æœºå™¨å­¦ä¹ æ˜¯AIçš„ä¸€ä¸ªå­é›†ï¼Œä½¿ç”¨ç®—æ³•è®©è®¡ç®—æœºä»æ•°æ®ä¸­å­¦ä¹ ã€‚æ·±åº¦å­¦ä¹ æ˜¯æœºå™¨å­¦ä¹ çš„ä¸€ä¸ªåˆ†æ”¯ï¼Œä½¿ç”¨å¤šå±‚ç¥ç»ç½‘ç»œæ¨¡æ‹Ÿäººè„‘å·¥ä½œæ–¹å¼ã€‚',
                        usage: 38,
                        lastUsed: new Date('2025-12-22'),
                        created: new Date('2025-12-19')
                    },
                    {
                        id: 3,
                        question: 'ç¥ç»ç½‘ç»œçš„åŸºæœ¬åŸç†',
                        category: 'æ·±åº¦å­¦ä¹ ',
                        tags: ['ç¥ç»ç½‘ç»œ', 'åŸç†', 'ç®—æ³•'],
                        answer: 'ç¥ç»ç½‘ç»œæ˜¯å—äººè„‘å¯å‘çš„è®¡ç®—æ¨¡å‹ï¼Œç”±ç›¸äº’è¿æ¥çš„èŠ‚ç‚¹(ç¥ç»å…ƒ)ç»„æˆã€‚æ¯ä¸ªè¿æ¥éƒ½æœ‰æƒé‡ï¼Œç½‘ç»œé€šè¿‡è°ƒæ•´è¿™äº›æƒé‡æ¥å­¦ä¹ ã€‚',
                        usage: 32,
                        lastUsed: new Date('2025-12-21'),
                        created: new Date('2025-12-18')
                    },
                    {
                        id: 4,
                        question: 'è‡ªç„¶è¯­è¨€å¤„ç†çš„åº”ç”¨åœºæ™¯',
                        category: 'è‡ªç„¶è¯­è¨€å¤„ç†',
                        tags: ['NLP', 'åº”ç”¨', 'åœºæ™¯'],
                        answer: 'NLPæŠ€æœ¯å¹¿æ³›åº”ç”¨äºæœºå™¨ç¿»è¯‘ã€æƒ…æ„Ÿåˆ†æã€æ–‡æœ¬æ‘˜è¦ã€é—®ç­”ç³»ç»Ÿã€è¯­éŸ³è¯†åˆ«ç­‰é¢†åŸŸï¼Œæ˜¯AIæŠ€æœ¯çš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚',
                        usage: 28,
                        lastUsed: new Date('2025-12-20'),
                        created: new Date('2025-12-17')
                    },
                    {
                        id: 5,
                        question: 'è®¡ç®—æœºè§†è§‰çš„ä¸»è¦ä»»åŠ¡',
                        category: 'è®¡ç®—æœºè§†è§‰',
                        tags: ['è®¡ç®—æœºè§†è§‰', 'ä»»åŠ¡', 'å›¾åƒ'],
                        answer: 'è®¡ç®—æœºè§†è§‰ä¸»è¦åŒ…æ‹¬å›¾åƒåˆ†ç±»ã€ç›®æ ‡æ£€æµ‹ã€è¯­ä¹‰åˆ†å‰²ã€å®ä¾‹åˆ†å‰²ã€äººè„¸è¯†åˆ«ç­‰ä»»åŠ¡ï¼Œåœ¨è‡ªåŠ¨é©¾é©¶ã€åŒ»ç–—å½±åƒç­‰é¢†åŸŸæœ‰é‡è¦åº”ç”¨ã€‚',
                        usage: 25,
                        lastUsed: new Date('2025-12-19'),
                        created: new Date('2025-12-16')
                    }
                ];

                const saved = localStorage.getItem('agent_knowledge_list');
                return saved ? JSON.parse(saved) : defaultKnowledge;
            }

            // æ¸²æŸ“çŸ¥è¯†åˆ—è¡¨
            renderKnowledgeList() {
                const container = document.getElementById('knowledge-list');
                const searchTerm = document.getElementById('search-input').value.toLowerCase();
                
                let filteredKnowledge = this.knowledgeBase;
                
                // æŒ‰åˆ†ç±»ç­›é€‰
                if (this.currentCategory !== 'all') {
                    filteredKnowledge = filteredKnowledge.filter(item => item.category === this.currentCategory);
                }
                
                // æŒ‰æœç´¢è¯ç­›é€‰
                if (searchTerm) {
                    filteredKnowledge = filteredKnowledge.filter(item => 
                        item.question.toLowerCase().includes(searchTerm) ||
                        item.answer.toLowerCase().includes(searchTerm) ||
                        item.tags.some(tag => tag.toLowerCase().includes(searchTerm))
                    );
                }
                
                // æ¸…ç©ºå®¹å™¨
                container.innerHTML = '';
                
                if (filteredKnowledge.length === 0) {
                    container.innerHTML = `
                        <div class="text-center py-12">
                            <div class="text-gray-500 text-lg mb-2">æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„çŸ¥è¯†æ¡ç›®</div>
                            <div class="text-gray-600 text-sm">å°è¯•è°ƒæ•´æœç´¢è¯æˆ–æ·»åŠ æ–°çš„çŸ¥è¯†æ¡ç›®</div>
                        </div>
                    `;
                    return;
                }
                
                // æ¸²æŸ“çŸ¥è¯†å¡ç‰‡
                filteredKnowledge.forEach((item, index) => {
                    const card = this.createKnowledgeCard(item, index);
                    container.appendChild(card);
                });
            }

            // åˆ›å»ºçŸ¥è¯†å¡ç‰‡
            createKnowledgeCard(item, index) {
                const card = document.createElement('div');
                card.className = 'knowledge-card rounded-lg p-6 mb-4 fade-in';
                card.style.animationDelay = `${index * 0.1}s`;
                
                const timeAgo = this.getTimeAgo(item.lastUsed);
                const tagColors = ['bg-blue-500', 'bg-green-500', 'bg-purple-500', 'bg-yellow-500', 'bg-pink-500'];
                
                card.innerHTML = `
                    <div class="flex items-start justify-between mb-4">
                        <div class="flex-1">
                            <h3 class="text-lg font-semibold text-white mb-2">${item.question}</h3>
                            <div class="flex items-center space-x-4 text-sm text-gray-400 mb-3">
                                <span class="bg-gray-600 px-2 py-1 rounded text-xs">${item.category}</span>
                                <span>ä½¿ç”¨ ${item.usage} æ¬¡</span>
                                <span>æœ€åä½¿ç”¨: ${timeAgo}</span>
                            </div>
                            <div class="flex flex-wrap gap-2 mb-3">
                                ${item.tags.map((tag, i) => `
                                    <span class="${tagColors[i % tagColors.length]} bg-opacity-20 text-xs px-2 py-1 rounded">
                                        ${tag}
                                    </span>
                                `).join('')}
                            </div>
                        </div>
                        <div class="flex space-x-2 ml-4">
                            <button onclick="editKnowledge(${item.id})" class="text-cyan-400 hover:text-cyan-300 p-2">
                                âœï¸
                            </button>
                            <button onclick="deleteKnowledge(${item.id})" class="text-red-400 hover:text-red-300 p-2">
                                ğŸ—‘ï¸
                            </button>
                        </div>
                    </div>
                    <div class="text-gray-300 text-sm leading-relaxed">
                        ${item.answer}
                    </div>
                `;
                
                return card;
            }

            // è·å–æ—¶é—´å·®
            getTimeAgo(date) {
                const now = new Date();
                const diff = now - new Date(date);
                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                
                if (days === 0) return 'ä»Šå¤©';
                if (days === 1) return 'æ˜¨å¤©';
                if (days < 7) return `${days}å¤©å‰`;
                if (days < 30) return `${Math.floor(days / 7)}å‘¨å‰`;
                return `${Math.floor(days / 30)}ä¸ªæœˆå‰`;
            }

            // åˆå§‹åŒ–å›¾è¡¨
            initChart() {
                const chartContainer = document.getElementById('knowledge-chart');
                const chart = echarts.init(chartContainer);
                
                // ç»Ÿè®¡å„åˆ†ç±»æ•°é‡
                const categoryStats = {};
                this.knowledgeBase.forEach(item => {
                    categoryStats[item.category] = (categoryStats[item.category] || 0) + 1;
                });
                
                const option = {
                    backgroundColor: 'transparent',
                    tooltip: {
                        trigger: 'item',
                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                        borderColor: '#00D4FF',
                        textStyle: { color: '#fff' }
                    },
                    series: [{
                        type: 'pie',
                        radius: ['40%', '70%'],
                        center: ['50%', '50%'],
                        data: Object.entries(categoryStats).map(([name, value]) => ({
                            name,
                            value,
                            itemStyle: {
                                color: this.getCategoryColor(name)
                            }
                        })),
                        label: {
                            color: '#fff',
                            fontSize: 10
                        },
                        labelLine: {
                            lineStyle: { color: '#666' }
                        }
                    }]
                };
                
                chart.setOption(option);
                
                // å“åº”å¼
                window.addEventListener('resize', () => {
                    chart.resize();
                });
            }

            // è·å–åˆ†ç±»é¢œè‰²
            getCategoryColor(category) {
                const colors = {
                    'äººå·¥æ™ºèƒ½': '#00D4FF',
                    'æœºå™¨å­¦ä¹ ': '#10B981',
                    'æ·±åº¦å­¦ä¹ ': '#F59E0B',
                    'è‡ªç„¶è¯­è¨€å¤„ç†': '#8B5CF6',
                    'è®¡ç®—æœºè§†è§‰': '#EF4444'
                };
                return colors[category] || '#6B7280';
            }

            // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
            updateStats() {
                document.getElementById('stats-total').textContent = this.knowledgeBase.length;
                document.getElementById('total-count').textContent = this.knowledgeBase.length;
            }

            // ä¿å­˜çŸ¥è¯†åº“
            saveKnowledgeBase() {
                localStorage.setItem('agent_knowledge_list', JSON.stringify(this.knowledgeBase));
            }

            // æ˜¾ç¤ºåé¦ˆ
            showFeedback(message, type = 'info') {
                const feedbackDiv = document.createElement('div');
                const bgColor = type === 'success' ? 'bg-green-500' : type === 'error' ? 'bg-red-500' : 'bg-blue-500';
                
                feedbackDiv.className = `fixed top-20 right-4 ${bgColor} text-white px-4 py-2 rounded-lg shadow-lg z-50 transform translate-x-full transition-transform duration-300`;
                feedbackDiv.textContent = message;
                
                document.body.appendChild(feedbackDiv);
                
                setTimeout(() => {
                    feedbackDiv.style.transform = 'translateX(0)';
                }, 100);
                
                setTimeout(() => {
                    feedbackDiv.style.transform = 'translateX(100%)';
                    setTimeout(() => {
                        feedbackDiv.remove();
                    }, 300);
                }, 3000);
            }
        }

        // å…¨å±€å˜é‡å’Œå‡½æ•°
        let knowledgeManager;
        let currentEditId = null;

        // é€‰æ‹©åˆ†ç±»
        function selectCategory(category) {
            // æ›´æ–°UIçŠ¶æ€
            document.querySelectorAll('.category-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`[data-category="${category}"]`).classList.add('active');
            
            // æ›´æ–°å½“å‰åˆ†ç±»å¹¶é‡æ–°æ¸²æŸ“
            knowledgeManager.currentCategory = category;
            knowledgeManager.renderKnowledgeList();
        }

        // æœç´¢çŸ¥è¯†
        function searchKnowledge() {
            knowledgeManager.renderKnowledgeList();
        }

        // æ’åºçŸ¥è¯†
        function sortKnowledge() {
            const sortBy = document.getElementById('sort-select').value;
            
            switch (sortBy) {
                case 'recent':
                    knowledgeManager.knowledgeBase.sort((a, b) => new Date(b.lastUsed) - new Date(a.lastUsed));
                    break;
                case 'usage':
                    knowledgeManager.knowledgeBase.sort((a, b) => b.usage - a.usage);
                    break;
                case 'name':
                    knowledgeManager.knowledgeBase.sort((a, b) => a.question.localeCompare(b.question));
                    break;
            }
            
            knowledgeManager.renderKnowledgeList();
        }

        // æ·»åŠ çŸ¥è¯†
        function addKnowledge() {
            currentEditId = null;
            document.getElementById('edit-panel').classList.remove('hidden');
            document.getElementById('question-input').value = '';
            document.getElementById('category-input').value = 'äººå·¥æ™ºèƒ½';
            document.getElementById('tags-input').value = '';
            document.getElementById('answer-input').value = '';
        }

        // ç¼–è¾‘çŸ¥è¯†
        function editKnowledge(id) {
            currentEditId = id;
            const item = knowledgeManager.knowledgeBase.find(k => k.id === id);
            
            if (item) {
                document.getElementById('edit-panel').classList.remove('hidden');
                document.getElementById('question-input').value = item.question;
                document.getElementById('category-input').value = item.category;
                document.getElementById('tags-input').value = item.tags.join(', ');
                document.getElementById('answer-input').value = item.answer;
            }
        }

        // åˆ é™¤çŸ¥è¯†
        function deleteKnowledge(id) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªçŸ¥è¯†æ¡ç›®å—ï¼Ÿ')) {
                knowledgeManager.knowledgeBase = knowledgeManager.knowledgeBase.filter(k => k.id !== id);
                knowledgeManager.saveKnowledgeBase();
                knowledgeManager.renderKnowledgeList();
                knowledgeManager.updateStats();
                knowledgeManager.initChart();
                knowledgeManager.showFeedback('çŸ¥è¯†æ¡ç›®å·²åˆ é™¤', 'success');
            }
        }

        // ä¿å­˜çŸ¥è¯†
        function saveKnowledge() {
            const question = document.getElementById('question-input').value.trim();
            const category = document.getElementById('category-input').value;
            const tags = document.getElementById('tags-input').value.split(',').map(tag => tag.trim()).filter(tag => tag);
            const answer = document.getElementById('answer-input').value.trim();
            
            if (!question || !answer) {
                knowledgeManager.showFeedback('è¯·å¡«å†™é—®é¢˜å’Œç­”æ¡ˆ', 'error');
                return;
            }
            
            if (currentEditId) {
                // æ›´æ–°ç°æœ‰çŸ¥è¯†
                const item = knowledgeManager.knowledgeBase.find(k => k.id === currentEditId);
                if (item) {
                    item.question = question;
                    item.category = category;
                    item.tags = tags;
                    item.answer = answer;
                }
                knowledgeManager.showFeedback('çŸ¥è¯†æ¡ç›®å·²æ›´æ–°', 'success');
            } else {
                // æ·»åŠ æ–°çŸ¥è¯†
                const newItem = {
                    id: Date.now(),
                    question,
                    category,
                    tags,
                    answer,
                    usage: 0,
                    lastUsed: new Date(),
                    created: new Date()
                };
                knowledgeManager.knowledgeBase.push(newItem);
                knowledgeManager.showFeedback('çŸ¥è¯†æ¡ç›®å·²æ·»åŠ ', 'success');
            }
            
            knowledgeManager.saveKnowledgeBase();
            knowledgeManager.renderKnowledgeList();
            knowledgeManager.updateStats();
            knowledgeManager.initChart();
            cancelEdit();
        }

        // å–æ¶ˆç¼–è¾‘
        function cancelEdit() {
            document.getElementById('edit-panel').classList.add('hidden');
            currentEditId = null;
        }

        // æ·»åŠ åˆ†ç±»
        function addCategory() {
            document.getElementById('category-modal').classList.remove('hidden');
        }

        // å…³é—­åˆ†ç±»å¼¹çª—
        function closeCategoryModal() {
            document.getElementById('category-modal').classList.add('hidden');
            document.getElementById('category-name-input').value = '';
            document.getElementById('category-icon-input').value = '';
        }

        // ä¿å­˜åˆ†ç±»
        function saveCategory() {
            const name = document.getElementById('category-name-input').value.trim();
            const icon = document.getElementById('category-icon-input').value.trim() || 'ğŸ“';
            
            if (!name) {
                knowledgeManager.showFeedback('è¯·è¾“å…¥åˆ†ç±»åç§°', 'error');
                return;
            }
            
            // æ£€æŸ¥åˆ†ç±»æ˜¯å¦å·²å­˜åœ¨
            const existingCategory = document.querySelector(`[data-category="${name}"]`);
            if (existingCategory) {
                knowledgeManager.showFeedback('åˆ†ç±»å·²å­˜åœ¨', 'error');
                return;
            }
            
            // æ·»åŠ åˆ°åˆ†ç±»åˆ—è¡¨
            const categoryList = document.getElementById('category-list');
            const categoryItem = document.createElement('div');
            categoryItem.className = 'category-item px-3 py-2 rounded cursor-pointer';
            categoryItem.setAttribute('data-category', name);
            categoryItem.setAttribute('onclick', `selectCategory('${name}')`);
            categoryItem.innerHTML = `
                <div class="flex items-center justify-between">
                    <span>${icon} ${name}</span>
                    <span class="text-xs bg-gray-600 px-2 py-1 rounded">0</span>
                </div>
            `;
            
            categoryList.appendChild(categoryItem);
            closeCategoryModal();
            knowledgeManager.showFeedback('åˆ†ç±»å·²æ·»åŠ ', 'success');
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            knowledgeManager = new KnowledgeManager();
        });
    </script>
</body>
</html>